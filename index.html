<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P Engine - GNU OpenGL Engine</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
         :root {
            --primary: #007AFF;
            --accent: #00f2ff;
            --bg: #0a0a0c;
            --card-bg: #16161a;
            --text: #ffffff;
            --text-dim: #a0a0a0;
            --nav-bg: rgba(10, 10, 12, 0.8);
            --border: #333;
            --input-bg: #222;
        }
        
        [data-theme="light"] {
            --bg: #f5f5f7;
            --card-bg: #ffffff;
            --text: #1d1d1f;
            --text-dim: #6e6e73;
            --nav-bg: rgba(245, 245, 247, 0.8);
            --border: #d2d2d7;
            --input-bg: #e8e8ed;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', sans-serif;
            transition: background 0.3s, color 0.3s;
        }
        
        body {
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.6;
            overflow-x: hidden;
        }
        /* Navigation */
        
        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 5%;
            background: var(--nav-bg);
            backdrop-filter: blur(10px);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid var(--border);
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            background: linear-gradient(45deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .nav-links button {
            background: none;
            border: none;
            color: var(--text-dim);
            margin: 0 15px;
            cursor: pointer;
            font-size: 1rem;
        }
        
        .nav-links button.active {
            color: var(--primary);
            font-weight: bold;
        }
        
        .controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .theme-toggle,
        .lang-switch {
            background: var(--input-bg);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 5px 10px;
            border-radius: 8px;
            cursor: pointer;
        }
        /* Content Sections */
        
        .section {
            display: none;
            padding: 100px 5% 50px;
            min-height: 100vh;
            animation: fadeIn 0.5s ease;
        }
        
        .section.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        /* Home Page Styling */
        
        .hero {
            text-align: center;
            padding: 20px 0;
        }
        
        .hero h1 {
            font-size: clamp(2.5rem, 8vw, 4rem);
            margin-bottom: 10px;
        }
        
        .hero p {
            color: var(--text-dim);
            font-size: 1.2rem;
            margin-bottom: 30px;
        }
        
        .screenshot-main {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .screenshot-main img {
            width: 40%;
            display: block;
            margin: 0 auto;
        }
        
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 50px;
        }
        
        .card {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 20px;
            border: 1px solid var(--border);
        }
        
        .card i {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 20px;
            display: block;
        }
        /* Install Page */
        
        .install-container {
            max-width: 600px;
            margin: 0 auto;
            background: var(--card-bg);
            padding: 40px;
            border-radius: 20px;
            border: 1px solid var(--border);
        }
        
        .version-select {
            width: 100%;
            padding: 12px;
            margin: 15px 0 25px;
            background: var(--input-bg);
            color: var(--text);
            border: 1px solid var(--border);
            border-radius: 8px;
        }
        
        .btn-download {
            display: block;
            width: 100%;
            padding: 16px;
            background: var(--primary);
            color: white;
            text-align: center;
            text-decoration: none;
            border-radius: 12px;
            font-weight: bold;
        }
        
        .history-info {
            margin-top: 20px;
            font-size: 0.9rem;
            color: var(--primary);
            text-align: center;
            font-style: italic;
        }
        /* Documentation Styling */
        
        .doc-nav {
            max-width: 1000px;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            background: var(--input-bg);
            padding: 10px 20px;
            border-radius: 10px;
            border: 1px solid var(--border);
        }
        
        #md-content {
            background: var(--card-bg);
            padding: 40px;
            border-radius: 20px;
            border: 1px solid var(--border);
            max-width: 1000px;
            margin: 0 auto;
        }
        /* Markdown Overrides */
        
        #md-content h1,
        #md-content h2 {
            margin-top: 20px;
            border-bottom: 1px solid var(--border);
            padding-bottom: 10px;
        }
        
        #md-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        #md-content th,
        #md-content td {
            border: 1px solid var(--border);
            padding: 10px;
            text-align: left;
        }
        
        #md-content th {
            background: var(--input-bg);
        }
        
        #md-content pre {
            background: #000 !important;
            color: #00ff00;
            padding: 20px;
            border-radius: 10px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
        }
        
        #md-content img {
            max-width: 100%;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: sans-serif;
            font-weight: bold;
            color: #00aaff;
            text-transform: uppercase;
        }
        
        .logo img {
            display: block;
            border-radius: 8px;
        }
    </style>
</head>

<body>

    <nav>
        <div class="logo">
            <img src="PEngine.png" alt="PEngine Demo Screenshot" style="width: 50px;"> <span>P Engine</span>
        </div>
        <div class="nav-links">
            <button onclick="showSection('home')" id="btn-home" class="active" data-key="nav_home">Home</button>
            <button onclick="showSection('install')" id="btn-install" data-key="nav_install">Install</button>
            <button onclick="showSection('docs')" id="btn-docs" data-key="nav_docs">Docs</button>
        </div>
        <div class="controls">
            <button class="theme-toggle" onclick="toggleTheme()"><i id="t-icon" class="fas fa-sun"></i></button>
            <select class="lang-switch" id="lang-select" onchange="updateLanguage()">
                <option value="en">EN</option>
                <option value="ru">RU</option>
            </select>
        </div>
    </nav>

    <section id="home" class="section active">
        <div class="hero">
            <h1 data-key="hero_title">GNU OpenGL Engine</h1>
            <p data-key="hero_desc">Quickly and enjoyably create 3D scenes.</p>
        </div>

        <div class="features">
            <div class="card"><i class="fas fa-cube"></i>
                <h3 data-key="f1_t">OpenGL Based</h3>
                <p data-key="f1_d">C++, GLFW, GLAD, and GLM core.</p>
            </div>
            <div class="card"><i class="fas fa-gamepad"></i>
                <h3 data-key="f2_t">Easy Input</h3>
                <p data-key="f2_d">Cross-platform input & audio.</p>
            </div>
            <div class="card"><i class="fas fa-bolt"></i>
                <h3 data-key="f3_t">Fast Dev</h3>
                <p data-key="f3_d">Ready tools for models and UI.</p>
            </div>
        </div>
    </section>

    <section id="install" class="section">
        <div class="install-container">
            <h2 data-key="ins_title">Download PEngen</h2>
            <label data-key="lbl_ver">Select Version:</label>
            <select class="version-select" id="install-ver-list" onchange="updateDlLink()"></select>
            <a href="#" class="btn-download" onclick="saveDownload()" id="main-dl-btn" data-key="btn_dl">Download</a>
            <div id="download-history" class="history-info"></div>
        </div>
    </section>

    <section id="docs" class="section">
        <div class="doc-nav">
            <span data-key="lbl_ver">Version:</span>
            <select class="lang-switch" id="docs-ver-list" onchange="loadMarkdown()"></select>
        </div>
        <div id="md-content">Loading Documentation...</div>
    </section>

    <script>
        let dictionary = {};
        let engineVersions = [];

        async function init() {
            // 1. Load Texts (launcher.json)
            try {
                const res = await fetch('launcher.json');
                const data = await res.json();
                dictionary = data.languages;
                const savedLang = localStorage.getItem('p_lang') || data.default_lang;
                document.getElementById('lang-select').value = savedLang;
            } catch (e) {
                console.warn("launcher.json not found, using fallbacks.");
            }

            // 2. Load Versions (version.json)
            try {
                const res = await fetch('version.json');
                const data = await res.json();
                engineVersions = data.versions;
                const iList = document.getElementById('install-ver-list');
                const dList = document.getElementById('docs-ver-list');

                engineVersions.forEach(v => {
                    let opt = new Option(v.name, v.id);
                    iList.add(opt);
                    dList.add(opt.cloneNode(true));
                });
                updateDlLink();
            } catch (e) {
                console.warn("version.json not found.");
            }

            // 3. Theme
            const theme = localStorage.getItem('p_theme') || 'dark';
            document.body.setAttribute('data-theme', theme);
            updateThemeIcon(theme);
            updateLanguage();
        }

        function updateLanguage() {
            const lang = document.getElementById('lang-select').value;
            localStorage.setItem('p_lang', lang);
            const dict = dictionary[lang];
            if (dict) {
                document.querySelectorAll('[data-key]').forEach(el => {
                    const key = el.getAttribute('data-key');
                    if (dict[key]) el.innerText = dict[key];
                });
            }
            if (document.getElementById('docs').classList.contains('active')) loadMarkdown();
            refreshHistory();
        }

        function toggleTheme() {
            const current = document.body.getAttribute('data-theme');
            const next = current === 'dark' ? 'light' : 'dark';
            document.body.setAttribute('data-theme', next);
            localStorage.setItem('p_theme', next);
            updateThemeIcon(next);
        }

        function updateThemeIcon(t) {
            document.getElementById('t-icon').className = t === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
        }

        function showSection(id) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-links button').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.getElementById('btn-' + id).classList.add('active');
            if (id === 'docs') loadMarkdown();
        }

        function updateDlLink() {
            const verId = document.getElementById('install-ver-list').value;
            const ver = engineVersions.find(v => v.id === verId);
            document.getElementById('main-dl-btn').href = ver ? ver.url : "#";
        }

        function saveDownload() {
            const verId = document.getElementById('install-ver-list').value;
            localStorage.setItem('p_last_dl', verId);
            setTimeout(refreshHistory, 500);
        }

        function refreshHistory() {
            const last = localStorage.getItem('p_last_dl');
            const lang = document.getElementById('lang-select').value;
            const box = document.getElementById('download-history');
            if (last) {
                box.innerText = (lang === 'ru' ? "Последняя загрузка: " : "Last download: ") + last;
            }
        }

        async function loadMarkdown() {
            const lang = document.getElementById('lang-select').value;
            const ver = document.getElementById('docs-ver-list').value;
            try {
                const res = await fetch(`docs/${ver}/readme_${lang}.md`);
                if (!res.ok) throw new Error();
                const text = await res.text();
                document.getElementById('md-content').innerHTML = marked.parse(text);
            } catch (e) {
                document.getElementById('md-content').innerHTML = `<h2>Error</h2><p>Documentation for ${ver} in ${lang.toUpperCase()} not found.</p>`;
            }
        }

        init();
    </script>
</body>

</html>